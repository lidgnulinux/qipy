# Build recipe for qipy-git.
#
# Exit immediately on any error
set -e

program=qipy-git
commit=fb39c7111a2b2c2b6d09915a085874ea84ad218e
version=0.4.r52.cfb39c711
release=0
description="Simple helper for qi to query information about package."
homepage="https://gitlab.com/lidgnulinux/qi_wrapper"
license="CUSTOM"

tarname=qi_wrapper-$commit.tar.gz
fetch="https://gitlab.com/lidgnulinux/qi_wrapper/-/archive/$commit/$tarname"

srcdir=qi_wrapper-$commit
replace=qipy

build() 
{
	unpack "${tardir}/$tarname"
	
	cd "$srcdir"
	
	# Set sane permissions
	chmod -R u+w,go-w,a+rX-s .

	mkdir -p "$destdir/etc/qipy"
	mkdir -p "$destdir/usr/share/qipy"
	mkdir -p "$destdir/usr/share/man/man1"
	mkdir -p "$destdir/usr/bin"
	mkdir -p "$destdir/usr/share/bash-completion/completions/"

	cp -r recipe-templates "${destdir}/etc/qipy/"
	cp -r patches "${destdir}/etc/qipy/"
	cp -r doc "${destdir}/usr/share/qipy/"
	cp -r doc/qipy.1 "$destdir/usr/share/man/man1"

	install -Dm0755 qi.py "${destdir}/usr/bin/qipy"
	install -Dm0755 bash-completion/qipy "$destdir/usr/share/bash-completion/completions/qipy"
	install -Dm0644 patches/enable_update_installed_packages.diff "${destdir}/etc/qipy/enable_update_installed_packages.diff"

}
